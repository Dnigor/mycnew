(function(){function ut(){var u=!1,n;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),u=!0,window.localStorage.removeItem("_tmptest")}catch(f){}if(u)try{window.localStorage&&(i=window.localStorage,r="localStorage",s=i.jStorage_update)}catch(e){}else if("globalStorage"in window)try{window.globalStorage&&(i=window.globalStorage[window.location.hostname],r="globalStorage",s=i.jStorage_update)}catch(o){}else if(t=document.createElement("link"),t.addBehavior){t.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(t);try{t.load("jStorage")}catch(h){t.setAttribute("jStorage","{}"),t.save("jStorage"),t.load("jStorage")}n="{}";try{n=t.getAttribute("jStorage")}catch(c){}try{s=t.getAttribute("jStorage_update")}catch(a){}i.jStorage=n,r="userDataBehavior"}else{t=null;return}it(),p(),y("local"),y("session"),ft(),rt(),"addEventListener"in window&&window.addEventListener("pageshow",function(n){n.persisted&&l()},!1)}function y(t,i){function l(){if(t=="session")try{o=u.parse(window.name||"{}")}catch(n){o={}}}function a(){t=="session"&&(window.name=u.stringify(o))}var c=!1,s=0,h,f,o={},v=Math.random();if(i||typeof window[t+"Storage"]=="undefined"){if(t=="local"&&window.globalStorage){localStorage=window.globalStorage[window.location.hostname];return}if(r=="userDataBehavior"){i&&window[t+"Storage"]&&window[t+"Storage"].parentNode&&window[t+"Storage"].parentNode.removeChild(window[t+"Storage"]),f=document.createElement("button"),document.getElementsByTagName("head")[0].appendChild(f),t=="local"?o=n:t=="session"&&l();for(h in o)o.hasOwnProperty(h)&&h!="__jstorage_meta"&&h!="length"&&typeof o[h]!="undefined"&&(h in f||s++,f[h]=o[h]);f.length=s,f.key=function(n){var i=0,t;l();for(t in o)if(o.hasOwnProperty(t)&&t!="__jstorage_meta"&&t!="length"&&typeof o[t]!="undefined"){if(i==n)return t;i++}},f.getItem=function(n){return(l(),t=="session")?o[n]:e.jStorage.get(n)},f.setItem=function(n,t){typeof t!="undefined"&&(f[n]=(t||"").toString())},f.removeItem=function(n){if(t=="local")return e.jStorage.deleteKey(n);f[n]=undefined,c=!0,n in f&&f.removeAttribute(n),c=!1},f.clear=function(){if(t=="session"){window.name="",y("session",!0);return}e.jStorage.flush()},t=="local"&&(d=function(n,t){n!="length"&&(c=!0,typeof t=="undefined"?n in f&&(s--,f.removeAttribute(n)):(n in f||s++,f[n]=(t||"").toString()),f.length=s,c=!1)}),f.attachEvent("onpropertychange",function(n){if(n.propertyName!="length"&&!c&&n.propertyName!="length"){if(t=="local")n.propertyName in o||typeof f[n.propertyName]=="undefined"||s++;else if(t=="session"){l(),typeof f[n.propertyName]=="undefined"||n.propertyName in o?typeof f[n.propertyName]=="undefined"&&n.propertyName in o?(delete o[n.propertyName],s--):o[n.propertyName]=f[n.propertyName]:(o[n.propertyName]=f[n.propertyName],s++),a(),f.length=s;return}e.jStorage.set(n.propertyName,f[n.propertyName]),f.length=s}}),window[t+"Storage"]=f}}}function tt(){var n="{}";if(r=="userDataBehavior"){t.load("jStorage");try{n=t.getAttribute("jStorage")}catch(u){}try{s=t.getAttribute("jStorage_update")}catch(f){}i.jStorage=n}it(),p(),rt()}function ft(){r=="localStorage"||r=="globalStorage"?"addEventListener"in window?window.addEventListener("storage",l,!1):document.attachEvent("onstorage",l):r=="userDataBehavior"&&setInterval(l,1e3)}function l(){var n;clearTimeout(g),g=setTimeout(function(){if(r=="localStorage"||r=="globalStorage")n=i.jStorage_update;else if(r=="userDataBehavior"){t.load("jStorage");try{n=t.getAttribute("jStorage_update")}catch(u){}}n&&n!=s&&(s=n,et())},25)}function et(){var i=u.parse(u.stringify(n.__jstorage_meta.CRC32)),r,t,f,e;tt(),r=u.parse(u.stringify(n.__jstorage_meta.CRC32)),f=[],e=[];for(t in i)if(i.hasOwnProperty(t)){if(!r[t]){e.push(t);continue}i[t]!=r[t]&&String(i[t]).substr(0,2)=="2."&&f.push(t)}for(t in r)r.hasOwnProperty(t)&&(i[t]||f.push(t));c(f,"updated"),c(e,"deleted")}function c(n,t){var u,i,e,r,o;if(n=[].concat(n||[]),t=="flushed"){n=[];for(u in f)f.hasOwnProperty(u)&&n.push(u);t="deleted"}for(i=0,e=n.length;i<e;i++)if(f[n[i]])for(r=0,o=f[n[i]].length;r<o;r++)f[n[i]][r](n[i],t)}function a(){var n=(+new Date).toString();r=="localStorage"||r=="globalStorage"?i.jStorage_update=n:r=="userDataBehavior"&&(t.setAttribute("jStorage_update",n),t.save("jStorage")),l()}function it(){if(i.jStorage)try{n=u.parse(String(i.jStorage))}catch(t){i.jStorage="{}"}else i.jStorage="{}";w=i.jStorage?String(i.jStorage).length:0,n.__jstorage_meta||(n.__jstorage_meta={}),n.__jstorage_meta.CRC32||(n.__jstorage_meta.CRC32={})}function v(){st();try{i.jStorage=u.stringify(n),t&&(t.setAttribute("jStorage",i.jStorage),t.save("jStorage")),w=i.jStorage?String(i.jStorage).length:0}catch(r){}}function o(n){if(!n||typeof n!="string"&&typeof n!="number")throw new TypeError("Key name must be string or numeric");if(n=="__jstorage_meta")throw new TypeError("Reserved key name");return!0}function p(){var u,t,i,f,r=Infinity,e=!1,o=[];if(clearTimeout(nt),n.__jstorage_meta&&typeof n.__jstorage_meta.TTL=="object"){u=+new Date,i=n.__jstorage_meta.TTL,f=n.__jstorage_meta.CRC32;for(t in i)i.hasOwnProperty(t)&&(i[t]<=u?(delete i[t],delete f[t],delete n[t],e=!0,o.push(t)):i[t]<r&&(r=i[t]));r!=Infinity&&(nt=setTimeout(p,r-u)),e&&(v(),a(),c(o,"deleted"))}}function rt(){var t,r,i;if(n.__jstorage_meta.PubSub){for(r=b,i=len=n.__jstorage_meta.PubSub.length-1;i>=0;i--)t=n.__jstorage_meta.PubSub[i],t[0]>b&&(r=t[0],ot(t[1],t[2]));b=r}}function ot(n,t){if(h[n])for(var i=0,r=h[n].length;i<r;i++)h[n][i](n,u.parse(u.stringify(t)))}function st(){var i,t,r;if(n.__jstorage_meta.PubSub){for(i=+new Date-2e3,t=0,r=n.__jstorage_meta.PubSub.length;t<r;t++)if(n.__jstorage_meta.PubSub[t][0]<=i){n.__jstorage_meta.PubSub.splice(t,n.__jstorage_meta.PubSub.length-t);break}n.__jstorage_meta.PubSub.length||delete n.__jstorage_meta.PubSub}}function ht(t,i){n.__jstorage_meta||(n.__jstorage_meta={}),n.__jstorage_meta.PubSub||(n.__jstorage_meta.PubSub=[]),n.__jstorage_meta.PubSub.unshift([+new Date,t,i]),v(),a()}function ct(n,t){for(var f=n.length,i=t^f,u=0,r;f>=4;)r=n.charCodeAt(u)&255|(n.charCodeAt(++u)&255)<<8|(n.charCodeAt(++u)&255)<<16|(n.charCodeAt(++u)&255)<<24,r=(r&65535)*1540483477+(((r>>>16)*1540483477&65535)<<16),r^=r>>>24,r=(r&65535)*1540483477+(((r>>>16)*1540483477&65535)<<16),i=(i&65535)*1540483477+(((i>>>16)*1540483477&65535)<<16)^r,f-=4,++u;switch(f){case 3:i^=(n.charCodeAt(u+2)&255)<<16;case 2:i^=(n.charCodeAt(u+1)&255)<<8;case 1:i^=n.charCodeAt(u)&255,i=(i&65535)*1540483477+(((i>>>16)*1540483477&65535)<<16)}return i^=i>>>13,i=(i&65535)*1540483477+(((i>>>16)*1540483477&65535)<<16),i^=i>>>15,i>>>0}var e=window.jQuery||window.$||(window.$={}),u={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(n){return String(n).evalJSON()}||e.parseJSON||e.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||e.toJSON};if(!u.parse||!u.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var n={__jstorage_meta:{CRC32:{}}},i={jStorage:"{}"},t=null,w=0,r=!1,f={},g=!1,s=0,h={},b=+new Date,nt,k={isXML:function(n){var t=(n?n.ownerDocument||n:0).documentElement;return t?t.nodeName!=="HTML":!1},encode:function(n){if(!this.isXML(n))return!1;try{return(new XMLSerializer).serializeToString(n)}catch(t){try{return n.xml}catch(i){}}return!1},decode:function(n){var i="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(n){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(n),t},t;return i?(t=i.call("DOMParser"in window&&new DOMParser||window,n,"text/xml"),this.isXML(t)?t:!1):!1}},d=function(){};e.jStorage={version:"0.3.2",set:function(t,i,r){if(o(t),r=r||{},typeof i=="undefined")return this.deleteKey(t),i;if(k.isXML(i))i={_is_xml:!0,xml:k.encode(i)};else{if(typeof i=="function")return undefined;i&&typeof i=="object"&&(i=u.parse(u.stringify(i)))}return n[t]=i,n.__jstorage_meta.CRC32[t]="2."+ct(u.stringify(i)),this.setTTL(t,r.TTL||0),d(t,i),c(t,"updated"),i},get:function(t,i){return(o(t),t in n)?n[t]&&typeof n[t]=="object"&&n[t]._is_xml?k.decode(n[t].xml):n[t]:typeof i=="undefined"?null:i},deleteKey:function(t){return(o(t),t in n)?(delete n[t],typeof n.__jstorage_meta.TTL=="object"&&t in n.__jstorage_meta.TTL&&delete n.__jstorage_meta.TTL[t],delete n.__jstorage_meta.CRC32[t],d(t,undefined),v(),a(),c(t,"deleted"),!0):!1},setTTL:function(t,i){var r=+new Date;return(o(t),i=Number(i)||0,t in n)?(n.__jstorage_meta.TTL||(n.__jstorage_meta.TTL={}),i>0?n.__jstorage_meta.TTL[t]=r+i:delete n.__jstorage_meta.TTL[t],v(),p(),a(),!0):!1},getTTL:function(t){var r=+new Date,i;return(o(t),t in n&&n.__jstorage_meta.TTL&&n.__jstorage_meta.TTL[t])?(i=n.__jstorage_meta.TTL[t]-r,i||0):0},flush:function(){return n={__jstorage_meta:{CRC32:{}}},y("local",!0),v(),a(),c(null,"flushed"),!0},storageObj:function(){function t(){}return t.prototype=n,new t},index:function(){var i=[],t;for(t in n)n.hasOwnProperty(t)&&t!="__jstorage_meta"&&i.push(t);return i},storageSize:function(){return w},currentBackend:function(){return r},storageAvailable:function(){return!!r},listenKeyChange:function(n,t){o(n),f[n]||(f[n]=[]),f[n].push(t)},stopListening:function(n,t){if(o(n),f[n]){if(!t){delete f[n];return}for(var i=f[n].length-1;i>=0;i--)f[n][i]==t&&f[n].splice(i,1)}},subscribe:function(n,t){if(n=(n||"").toString(),!n)throw new TypeError("Channel not defined");h[n]||(h[n]=[]),h[n].push(t)},publish:function(n,t){if(n=(n||"").toString(),!n)throw new TypeError("Channel not defined");ht(n,t)},reInit:function(){tt()}},ut()})();